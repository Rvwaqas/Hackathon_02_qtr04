Thank you for installing {{ .Chart.Name }} v{{ .Chart.Version }}!

Your release is named {{ .Release.Name }}.

== Getting Started ==

1. Get the frontend URL:
   {{- if eq .Values.frontend.service.type "NodePort" }}
   minikube service {{ include "todo-chatbot.frontend.fullname" . }} --url

   Or manually:
   export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "todo-chatbot.frontend.fullname" . }})
   export NODE_IP=$(minikube ip)
   echo "Frontend URL: http://${NODE_IP}:${NODE_PORT}"
   {{- else }}
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ include "todo-chatbot.frontend.fullname" . }} 3000:{{ .Values.frontend.service.port }}
   echo "Frontend URL: http://localhost:3000"
   {{- end }}

2. Verify backend health:
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ include "todo-chatbot.backend.fullname" . }} 8000:{{ .Values.backend.service.port }}
   curl http://localhost:8000/health

3. Check pod status:
   kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/instance={{ .Release.Name }}"

4. View logs:
   kubectl logs -l app=todo-backend --namespace {{ .Release.Namespace }}
   kubectl logs -l app=todo-frontend --namespace {{ .Release.Namespace }}

{{- if .Values.dapr.enabled }}

== Dapr Integration (Phase V Part B) ==

5. Verify Dapr sidecars (should show 2/2 containers):
   kubectl get pods --namespace {{ .Release.Namespace }}

6. Check Dapr components:
   kubectl get components.dapr.io --namespace {{ .Release.Namespace }}

7. View Dapr sidecar logs:
   kubectl logs -l app=todo-backend -c daprd --namespace {{ .Release.Namespace }}

8. Test Pub/Sub publishing:
   kubectl exec deployment/{{ include "todo-chatbot.backend.fullname" . }} -c {{ .Values.backend.name }} -- \
     curl -s -X POST http://localhost:3500/v1.0/publish/kafka-pubsub/task-events \
     -H "Content-Type: application/json" \
     -d '{"specversion":"1.0","type":"com.todo.task.test","source":"/test","id":"test-1","data":{"test":true}}'

{{- end }}

{{- if .Values.kafka.enabled }}

== Kafka (Redpanda) ==

9. Verify Redpanda is running:
   kubectl get pods -l app=redpanda --namespace {{ .Release.Namespace }}

10. Consume messages from task-events topic:
    kubectl exec deployment/redpanda -- rpk topic consume task-events -n 1 --brokers localhost:9092

11. List topics:
    kubectl exec deployment/redpanda -- rpk topic list --brokers localhost:9092

{{- end }}

== Troubleshooting ==

If pods are not starting, check events:
  kubectl get events --namespace {{ .Release.Namespace }} --sort-by=.lastTimestamp

If secrets are missing, create them first:
  kubectl create secret generic {{ include "todo-chatbot.fullname" . }}-secrets \
    --from-literal=database-url=YOUR_DATABASE_URL \
    --from-literal=cohere-api-key=YOUR_COHERE_API_KEY \
    --from-literal=jwt-secret=YOUR_JWT_SECRET

{{- if .Values.dapr.enabled }}
If Dapr sidecar is not injecting:
  1. Verify Dapr is installed: dapr status -k
  2. Check namespace annotations
  3. Restart the deployment: kubectl rollout restart deployment/{{ include "todo-chatbot.backend.fullname" . }}
{{- end }}
